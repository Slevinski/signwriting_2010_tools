<!DOCTYPE html>
<html>
<head>
  <title>SignWriting 2010 Glyph Sizing</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="signwriting_2010.css">
  <style>
    body{background:gray;}
  </style>
  <script src="signwriting_2010.js"></script>
  <script src="symsize.js"></script>
  <script>


var hello = 'M518x529S14c20481x471S27106503x489';
var world = 'M518x533S1870a489x515S18701482x490S20500508x496S2e734500x468';

function helloWorld(){
    var report = '<h2>SVG images using TrueType fonts</h2>';
    report += getSignSvg(hello) + "<br><br>";
    report += getSignSvg(world);
    var helloCanvas = getSignCanvas(hello);
    var helloImage = helloCanvas.toDataURL("image/png");
    var worldCanvas = getSignCanvas(world);
    var worldImage = worldCanvas.toDataURL("image/png");
    report += '<hr>';
    report += '<h2>HTML 5 Canvas images using TrueType fonts</h2>';
    report += '<h3>canvas export to PNG images</h3>';
    report += '<img src="' + helloImage + '"/><br><br>'
    report += '<img src="' + worldImage + '"/>'
    report += '<h3>canvas written to document</h3>';
    document.getElementById("output").innerHTML = report
    document.getElementById("output").appendChild(getSignCanvas(hello));
    document.getElementById("output").appendChild(document.createElement("br"));
    document.getElementById("output").appendChild(document.createElement("br"));
    document.getElementById("output").appendChild(getSignCanvas(world));
}

function check(seconds){
  var start = new Date().getTime();
  var size,newSize;
  var gross=0;minor=0,details='',count=0;
  var report = '<p>';
  for (var key in symSize) {
    size = symSize[key];
    newSize = getSymSize(key);
    
    if(!newSize){
      report += '<h2>SignWriting 2010 Font not installed!</h2>\n';
      report += '<p>Please download and install the SignWriting 2010 Fonts:';
      report += '<ul><li><a href="https://github.com/Slevinski/signwriting_2010_fonts/raw/master/fonts/SignWriting%202010.ttf">SignWriting 2010</a>';
      report += '<li><a href="https://github.com/Slevinski/signwriting_2010_fonts/raw/master/fonts/SignWriting%202010%20Filling.ttf">SignWriting 2010 Filling</a>';
      break;
    }

    sizeW = parseInt(size.slice(0,3));
    sizeH = parseInt(size.slice(4,7));
    newW = parseInt(newSize.slice(0,3));
    newH = parseInt(newSize.slice(4,7));

    diffW = newW - sizeW;
    diffH = newH - sizeH;

    if (size != newSize) minor+=1
    if ((Math.abs(diffH) + Math.abs(diffW))>3){
      gross+=1;
      details = details + key + ' with size ' + size + ' is reporting ' + newW + "x" + newH + '<br>\n';
    } else if (diffW || diffH){
      minor+=1;
    }
    if (new Date().getTime()>(start+seconds*1000)) break;
    count += 1;
  }
  var end = new Date().getTime();
  var time = end - start;
  if (count){
    report += '<p>Properly sized '+ (count-gross) + ' glyphs in ' + parseInt(time/1000) + ' seconds with ' + minor + ' minor errors<br>\n';
    if (gross) {
      report += '<p>FAILURE: ' + gross + ' glyphs have sizing errors<br>\n';
      report += details;
    }
    var length = Object.keys(symSize).length;
    report += '<p>Symbols unprocessed: ' + (length-count) + '<br>\n';
    report += 'Additional time required: ' + parseInt(time * ((length/count)-1)/1000) + ' seconds<br>\n';
  }
  document.getElementById("output").innerHTML = report;
}
  </script>
</head>
<body>
  <h1>SignWriting 2010 Glyph Sizing</h1>
  <button onclick="helloWorld();return false;">Hello World</button>
  <h2>Speed and Accuracy Test</h2>
  <div id="process">
    <p>Max processing time:
    <button onclick="check(1);return false;">1 second</button>
    <button onclick="check(5);return false;">5 second</button>
    <button onclick="check(10);return false;">10 second</button>
    <button onclick="check(30);return false;">30 second</button>
    <button onclick="check(60);return false;">1 minute</button>
    <button onclick="check(120);return false;">2 minutes</button>
  </div>
  <hr>
  <div id="output">
  </div>
  <div id="canvas">
  </div>
</body>
</html>
